<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v4.1.1/dist/aframe-extras.min.js"></script>
    <script src="js/random.js"></script>

    <!-- HTTPS redirect -->
    <script>
      if (location.protocol !== "https:") {
        location.replace(
          `https:${location.href.substring(location.protocol.length)}`
        );
      }
    </script>

    <!-- Random Crap -->
    <script>
      AFRAME.registerComponent("distribute", {
        schema: {
          src: { type: "string" },
          jitter: { type: "vec3" },
          centerOffset: { type: "vec3" },
          radius: { type: "number" }
        },
        init: function() {
          const rg = new Random(Random.engines.mt19937().seed(10));
          const center = new THREE.Vector3(
            this.data.centerOffset.x,
            this.data.centerOffset.y,
            this.data.centerOffset.z
          );
          const jx = this.data.jitter.x;
          const jy = this.data.jitter.y;
          const jz = this.data.jitter.z;
          if ($(this.data.src).hasLoaded) {
            const s = this.data.radius;
            for (let i = -s; i < s; i++) {
              for (let j = -s; j < s; j++) {
                const el = document.createElement("a-entity");
                el.setAttribute("gltf-model", this.data.src);
                const offset = new THREE.Vector3(
                  i * s + rg.real(-jx, jx),
                  rg.real(-jy, jy),
                  j * s - rg.real(-jz, jz)
                );
                el.setAttribute("position", center.clone().add(offset));
                el.setAttribute("rotation", {
                  x: 0,
                  y: (rg.real(-45, 45) * Math.PI) / 180,
                  z: 0
                });
                const scale = rg.real(0.5, 1.5);
                el.setAttribute("scale", { x: scale, y: scale, z: scale });
                $("a-scene").appendChild(el);
              }
            }
          }
        }
      });
    </script>

    <!-- Flight -->
    <script type="text/javascript">
      AFRAME.registerComponent("listener", {
        schema: {
          stepFactor: {
            type: "number",
            default: 0.05
          }
        },
        tick: function() {
          this.el.components.camera.camera.parent.position.add(
            this.el.components.camera.camera
              .getWorldDirection()
              .multiplyScalar(this.data.stepFactor)
          );
        }
      });
    </script>
  </head>

  <body>
    <a-scene>
      <a-assets>
        <a-asset-item
          id="rock"
          src="https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2FRubbishAsteroid.glb?v=1634518101527"
        ></a-asset-item>
      </a-assets>

      <!-- The Ship -->
      <a-entity id="rig" movement-controls="fly: true; speed: 0.1">
        <a-entity
          camera
          listener="stepFactor:0.01"
          position="0 1.6 10"
          look-controls
        >
          <a-cursor></a-cursor>
        </a-entity>
      </a-entity>

      <!-- The Environment -->
      <a-box position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
      <a-sphere position="0 1.25 -5" radius="1.25" color="#EF2D5E"></a-sphere>
      <a-cylinder
        position="1 0.75 -3"
        radius="0.5"
        height="1.5"
        color="#FFC65D"
      ></a-cylinder>
      <a-plane
        position="0 0 -4"
        rotation="-90 0 0"
        width="4"
        height="4"
        color="#7BC8A4"
      ></a-plane>
      <a-gltf-model
        src="https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2FRubbishAsteroid.gltf?v=1634517502547"
        material="src:https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2FAsteroidTexture.png?v=1634518260827"
        position="0 0 0"
        rotation="-90 0 0"
      ></a-gltf-model>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>
  </body>
</html>


<a-sphere radius="1.25" position="0 1.25 -5" material="src: [object HTMLImageElement]" shadow="" geometry="">
	</a-sphere>