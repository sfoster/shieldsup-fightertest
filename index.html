<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- physics and other extras -->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.min.js"></script>
    <!-- alternate random number generator -->
    <script src="js/random.js"></script>
    <!-- utility functions from the Tutorial https://hacks.mozilla.org/2018/03/immersive-aframe-low-poly/ -->
    <!-- particle systems -->
    <script src="https://unpkg.com/aframe-particle-system-component@1.0.x/dist/aframe-particle-system-component.min.js"></script>
    <script>
      $ = sel => document.querySelector(sel);
      $$ = sel => document.querySelectorAll(sel);
      on = (elem, type, hand) => elem.addEventListener(type, hand);
    </script>

    <!-- HTTPS redirect -->
    <script>
      if (location.protocol !== "https:") {
        location.replace(
          `https:${location.href.substring(location.protocol.length)}`
        );
      }
    </script>

    <!-- from a SQLlite example project -->
    <script
      src="https://code.jquery.com/jquery-2.2.1.min.js"
      integrity="sha256-gvQgAFzTH6trSrAWoH1iPo9Xc96QxSZ3feW6kem+O00="
      crossorigin="anonymous"
    ></script>
    <script src="/client.js"></script>

    <!-- Flight -->
    <script type="text/javascript">
      AFRAME.registerComponent("listener", {
        schema: {
          stepFactor: {
            type: "number",
            default: 0.05
          }
        },
        tick: function() {
          this.el.components.camera.camera.parent.position.add(
            this.el.components.camera.camera
              .getWorldDirection()
              .multiplyScalar(this.data.stepFactor)
          );
        }
      });
    </script>
  </head>

  <!-- Asset List -->
  <body>
    <a-scene>
      <a-assets>
        <a-asset-item
          id="rock"
          src="https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2FRubbishAsteroid.glb?v=1634518101527"
        ></a-asset-item>
        <a-asset-item
          id="planet"
          src="https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2FPlanet.gltf?v=1634667469737"
        ></a-asset-item>
        <a-asset-item
          id="planet2o"
          src="https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2FTest_planet.obj?v=1634669432637"
        ></a-asset-item>
        <a-asset-item
          id="planet2m"
          src="https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2FTest_planet.mtl?v=1634669452429"
        ></a-asset-item>
        <a-asset-item
          id="ringo"
          src="https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2FTest_ring.obj?v=1634673464331"
        ></a-asset-item>
        <a-asset-item
          id="ringm"
          src="https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2FTest_Rings.png?v=1634673473137"
        ></a-asset-item>
      </a-assets>

      <!-- The Ship -->
      <a-entity id="rig" movement-controls="fly: true; speed: 0.1">
        <a-entity
          camera
          listener="stepFactor:0.01"
          position="0 1.6 10"
          look-controls
        >
          <a-cursor></a-cursor>
        </a-entity>
      </a-entity>

      <!-- The Environment -->

      <a-entity>
        <!-- Asteroid Field-->
        <a-gltf-model
          src="#rock"
          position="0 0 0"
          scale=".5 .5 .5"
          rotation="0 0 0"
        ></a-gltf-model>
        <a-gltf-model
          src="#rock"
          position="5 0 5"
          scale=".5 .5 .5"
          rotation="90 0 0"
        ></a-gltf-model>
        <a-gltf-model
          src="#rock"
          position="-7 0 4"
          scale=".5 .5 .5"
          rotation="0 0 180"
        ></a-gltf-model>
        <a-gltf-model
          src="#rock"
          position="8 0 -6"
          scale=".5 .5 .5"
          rotation="0 270 0"
        ></a-gltf-model>
        <a-gltf-model
          src="#rock"
          position="-4 0 -5"
          scale=".5 .5 .5"
          rotation="270 0 0"
        ></a-gltf-model>

        <!-- The Planet! -->
        <a-gltf-model
          position="-300 0 -200"
          scale="20 20 20"
          src="#planet"
          material="fog: false"
        ></a-gltf-model>
      </a-entity>

      <!-- Super laggy for some reason 
      <a-entity position="0 0 0" particle-system="preset: dust; texture: https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2FDustSpeck.png?v=1634660823690; color: #0000FF,#00FF00,#FF0000"></a-entity>
      -->

      <!-- Attempted Asteroid Field 
      <a-entity distribute="jitter: 2 0.5 2; centerOffset: 59 -0.8 32; src:"https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2FRubbishAsteroid.gltf?v=1634517502547"; radius:3"></a-entity>
      -->

      <!-- pretty sky, cause why not! -->
      <a-sky
        id="sky"
        rotation="0 180 0"
        src="https://cdn.glitch.me/e99f4064-e398-48d8-882b-d24a844fbb01%2Fpanorama_image.png?v=1634611197961"
      ></a-sky>

      <a-light
        type="directional"
        intensity="2"
        position="0 0 0"
        rotation="-90 0 0"
        target="#directionaltarget"
      >
        <a-entity id="directionaltarget" position="0 -1 0"></a-entity>
      </a-light>
      <a-light type="ambient"></a-light>
    </a-scene>
  </body>
</html>
